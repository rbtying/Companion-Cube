/*
 * Sabertooth.h
 *
 *  Created on: Aug 31, 2011
 *      Author: rbtying
 */

#ifndef SABERTOOTH_H_
#define SABERTOOTH_H_

#include <WProgram.h>
#include "NewSoftSerial.h"

#define SBT_BAUD_RATE 19200
#define SBT_BAUDING_CHAR 0xaa

#define SBT_OP_M1_FWD 0
#define SBT_OP_M1_REV 1
#define SBT_OP_MIN_VOLT 2
#define SBT_OP_MAX_VOLT 3
#define SBT_OP_M2_FWD 4
#define SBT_OP_M2_REV 5

class Sabertooth: NewSoftSerial {
public:
	Sabertooth(uint8_t address, uint8_t txPin, uint8_t emStopPin);
	Sabertooth(uint8_t address, uint8_t txPin);

	void emStop();
	void reset();

	void setMinVoltage(float voltage);
	void setMaxVoltage(float voltage);

	void setSpeed(int8_t left, int8_t right);
	void setSpeed(int8_t left, int8_t right, bool leftFwd, bool rightFwd);
	void setLeftSpeed(int8_t spd);
	void setRightSpeed(int8_t spd);
	int16_t getLeftSpeed();
	int16_t getRightSpeed();

private:
	bool m_em_stop_en;
	uint8_t m_address;
	uint8_t m_stopPin;
	int16_t m_left_speed, m_right_speed;
	void sendPacket(uint8_t op, uint8_t data);
	uint8_t checksum(uint8_t op, uint8_t data);
	void setMotorSpeed(uint8_t op, uint8_t spd);
};

#endif /* SABERTOOTH_H_ */
