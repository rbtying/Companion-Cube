/*
 * state_struct.h
 *
 *  Created on: Dec 1, 2011
 *      Author: rbtying
 */

#ifndef STATE_STRUCT_H_
#define STATE_STRUCT_H_

struct robot_state {
	uint8_t servo_pan_val;
	uint8_t servo_tilt_val;
	int16_t batt_motor_voltage;
	int16_t batt_motor_current;
	int16_t gyro_yaw_rate;
	int16_t gyro_yaw_val;
	int16_t enc_left_speed;
	int16_t enc_right_speed;
	int32_t enc_left_count;
	int32_t enc_right_count;
	int16_t enc_left_conv;
	int16_t enc_right_conv;
	int8_t motor_left_val;
	int8_t motor_right_val;
	int16_t pid_left_proportional;
	int16_t pid_left_integral;
	int16_t pid_left_derivative;
	int16_t pid_left_setpoint;
	int16_t pid_right_proportional;
	int16_t pid_right_integral;
	int16_t pid_right_derivative;
	int16_t pid_right_setpoint;
};
typedef struct robot_state robot_state;

#define STATE_STRUCT_SIZE 44

void byteToStateStruct(uint8_t * buf, robot_state * state) {
	state->servo_pan_val = buf[0];
	state->servo_tilt_val = buf[1];
	state->batt_motor_voltage = buf[2] << 8u | buf[3];
	state->batt_motor_current = buf[4] << 8u | buf[5];
	state->gyro_yaw_rate = buf[6] << 8u | buf[7];
	state->gyro_yaw_val = buf[8] << 8u | buf[9];
	state->enc_left_speed = buf[10] << 8u | buf[11];
	state->enc_right_speed = buf[12] << 8u | buf[13];
	state->enc_left_count = buf[14] << 24u | buf[15] << 16u | buf[16] << 8u
			| buf[17];
	state->enc_right_count = buf[18] << 24u | buf[19] << 16u | buf[20] << 8u
			| buf[21];
	state->enc_left_conv = buf[22] << 8u | buf[23];
	state->enc_right_conv = buf[24] << 8u | buf[25];
	state->motor_left_val = buf[26];
	state->motor_right_val = buf[27];
	state->pid_left_proportional = buf[28] << 8u | buf[29];
	state->pid_left_integral = buf[30] << 8u | buf[31];
	state->pid_left_derivative = buf[32] << 8u | buf[33];
	state->pid_left_setpoint = buf[34] << 8u | buf[35];
	state->pid_right_proportional = buf[36] << 8u | buf[37];
	state->pid_right_integral = buf[38] << 8u | buf[39];
	state->pid_right_derivative = buf[40] << 8u | buf[41];
	state->pid_right_setpoint = buf[42] << 8u | buf[43];
}

void stateStructToByte(robot_state * state, uint8_t * buf) {
	buf[0] = state->servo_pan_val;
	buf[1] = state->servo_tilt_val;
	buf[2] = state->batt_motor_voltage >> 8u;
	buf[3] = state->batt_motor_voltage & 0xff;
	buf[4] = state->batt_motor_current >> 8u;
	buf[5] = state->batt_motor_current & 0xff;
	buf[6] = state->gyro_yaw_rate >> 8u;
	buf[7] = state->gyro_yaw_rate & 0xff;
	buf[8] = state->gyro_yaw_val >> 8u;
	buf[9] = state->gyro_yaw_val & 0xff;
}

#endif /* STATE_STRUCT_H_ */
